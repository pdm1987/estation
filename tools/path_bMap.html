<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gbk" />
<style type="text/css">
textarea
{
width:100%;
height:100%;
}

body,html,#allmap {
	width: 100%;
	height: 100%;
	overflow: hidden;
	margin: 0;
}

#l-map {
	height: 100%;
	width: 78%;
	float: left;
	border-right: 2px solid #bcbcbc;
}

#r-result {
	height: 50%;
	width: 20%;
	float: left;
	border-bottom: 2px solid #bcbcbc;
}
#coordinate {
	height: 25%;
	width: 20%;
	float: left;
	border-bottom: 2px solid #bcbcbc;
}
#sfsf {
	height: 25%;
	width: 20%;
	float: left;
	border-bottom: 2px solid #bcbcbc;
}

</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>
<script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/changeMore.js"></script>
<title>linedist 百度地图验证</title>
</head>
<body>
	<div id="l-map"></div>
	<div id="r-result">
		<textarea id="r">
		</textarea>
	</div>
	<div id="coordinate">
		<textarea id="r2">
		</textarea>
	</div>
	<div id="sfsf">
		 <td>
				 <input  type="button" class=btnButon  value="转换" onclick="convert_wuyao();">
		 </td>
		  <td>
				 <input  type="button" class=btnButon  value="显示" onclick="show();">
		 </td>
		 <td>
				 <input  type="button" class=btnButon  value="批次转换" onclick="convert_more();">
		 </td>
	</div>
	<script type="text/javascript">

var map = new BMap.Map("l-map");            // 创建Map实例
map.centerAndZoom("宿迁", 14);
map.addEventListener("click", function(e) {
	document.getElementById("coordinate").innerHTML = e.point.lng+ ", " + e.point.lat;
	document.getElementById("r").innerHTML += e.point.lng+ "," + e.point.lat+'\n';
	});

wuyao_Point=[
new BMap.Point(118.21633,33.95965),
new BMap.Point(118.23959,33.96029),
new BMap.Point(118.25053,33.96075),
new BMap.Point(118.25869,33.96097),
new BMap.Point(118.26521,33.96053),
new BMap.Point(118.27113,33.95998),
new BMap.Point(118.27292,33.95986),
new BMap.Point(118.27496,33.95971),
new BMap.Point(118.27478,33.95751),
new BMap.Point(118.27457,33.95591),
new BMap.Point(118.27422,33.95203),
new BMap.Point(118.27383,33.94868),
new BMap.Point(118.27706,33.94833),
new BMap.Point(118.27772,33.94890),
new BMap.Point(118.27815,33.94861),
new BMap.Point(118.28341,33.95045),
new BMap.Point(118.28931,33.95200),
new BMap.Point(118.29114,33.95196),
new BMap.Point(118.29194,33.95201),
new BMap.Point(118.29384,33.95200),
new BMap.Point(118.29888,33.95146),
new BMap.Point(118.30030,33.95132),
new BMap.Point(118.29991,33.95406),
new BMap.Point(118.29978,33.95678),
new BMap.Point(118.30308,33.95648),
new BMap.Point(118.30633,33.95605),
new BMap.Point(118.30860,33.95530),
new BMap.Point(118.30986,33.95811),
new BMap.Point(118.30974,33.95872),
new BMap.Point(118.30900,33.95885),
new BMap.Point(118.30925,33.96385),
new BMap.Point(118.30465,33.96438),
new BMap.Point(118.30051,33.96485),
new BMap.Point(118.30144,33.97013),
new BMap.Point(118.30221,33.97438),
new BMap.Point(118.30216,33.97489),
new BMap.Point(118.29984,33.97507),
new BMap.Point(118.29568,33.97588)
];


var wuyao_path=[];
var bconv_path=[];
var wuyao_line;
var bconv_line;
var overlays=[];


for(var i=0; i<wuyao_Point.length; i++){
	mark = new BMap.Marker(wuyao_Point[i]);
	//map.addOverlay(mark);
	wuyao_path.push(wuyao_Point[i]);
}
wuyao_line=new BMap.Polyline(wuyao_path);
wuyao_line.setStrokeColor('#666666')
map.addOverlay(wuyao_line);



translateCallback = function (point){
	  mark = new BMap.Marker(point);
	  map.addOverlay(mark)
	  overlays.push(marker)
    bconv_path.push(point);
}

//单点转换顺序不正确，但能够看到点是正确的
//51地图的坐标系和google坐标系相同，应该是GCJ-02加密后的
//宿迁公交公司提供的站点坐标
function convert_wuyao()
{
	bconv_path=[]
	remove_overlays()
	for(var i=0; i<wuyao_Point.length; i++){
		//BMap.Convertor.translate(wuyao_Point[i],2,translateCallback);     //真实经纬度转成百度坐标参数0, googel 坐标参数2
	}
	
}



function callback(xyResults){
 var xyResult = null;
 for(var index in xyResults){
  xyResult = xyResults[index];
  if(xyResult.error != 0){continue;}//出错就直接返回;
  var point = new BMap.Point(xyResult.x, xyResult.y);
     var marker = new BMap.Marker(point);
     map.addOverlay(marker);
     overlays.push(marker)
     bconv_path.push(point)
    }
}
function convert_more()
{
	bconv_path=[]
	remove_overlays()
	BMap.Convertor.transMore(wuyao_Point,2,callback);
}


function show()
{
	bconv_line=new BMap.Polyline(bconv_path);
	map.addOverlay(bconv_line);
	overlays.push(bconv_line)
}

function remove_overlays()
{
	for(var i=0; i<overlays.length;i++)
	{
		map.removeOverlay(overlays[i])
	}
}

</script>
</body>
</html>



 